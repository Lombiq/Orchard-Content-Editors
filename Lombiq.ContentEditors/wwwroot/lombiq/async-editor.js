"use strict";

/* global Vue */
/* global VueRouter */

if (!window.asyncEditor) window.asyncEditor = {
  editors: []
};
class AsyncEditorApiClient {
  constructor(parameters) {
    this.apiUrl = parameters.apiUrl;
    this.asyncEditorId = parameters.asyncEditorId;
    this.providerName = parameters.providerName;
    this.contentType = parameters.contentType;
  }
  loadEditor(contentId, editorGroup, callback) {
    return fetch(this.createUrl(contentId, editorGroup)).then(response => response.json()).then(data => callback(true, data)).catch(error => callback(false, error));
  }
  submitEditor(contentId, editorGroup, nextEditorGroup, formData, callback) {
    return fetch(this.createUrl(contentId, editorGroup, nextEditorGroup), {
      method: 'post',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'
      },
      body: new URLSearchParams(formData)
    }).then(response => response.json()).then(data => callback(true, data)).then(() => {
      const submittedEditorEvent = new CustomEvent('asyncEditorSubmittedEditor', {
        bubbles: true,
        cancelable: true,
        detail: {
          asyncEditor: window.asyncEditor
        }
      });
      document.dispatchEvent(submittedEditorEvent);
    }).catch(error => callback(false, error));
  }
  createUrl(contentId, editorGroup, nextEditorGroup) {
    const url = new URL(this.apiUrl, document.baseURI);
    const query = {
      asyncEditorId: this.asyncEditorId,
      providerName: this.providerName,
      contentType: this.contentType
    };
    if (contentId) query.contentId = contentId;
    if (editorGroup) query.editorGroup = editorGroup;
    if (nextEditorGroup) query.nextEditorGroup = nextEditorGroup;
    url.search = new URLSearchParams(query).toString();
    return url;
  }
}
const router = new VueRouter();

// Making the Vue object more readable.
// eslint-disable-next-line object-shorthand
window.asyncEditor.editor = {
  template: '#async-editor-template',
  data() {
    return {
      asyncEditorId: '',
      api: null,
      message: '',
      errorText: '',
      contentId: '',
      editorHtml: '',
      validationSummaryHtml: '',
      editorGroup: '',
      editorGroups: [],
      defaultErrorText: '',
      scriptsHtml: ''
    };
  },
  computed: {
    progress(self) {
      if (self.editorGroups.length < 1) return 0;
      return self.editorGroups.filter(group => group.isFilled).length / self.editorGroups.length * 100;
    },
    showProgressBar(self) {
      return self.editorGroups.length > 1;
    }
  },
  watch: {
    '$route.query'() {
      this.processQuery();
    }
  },
  router,
  updated() {
    const self = this;
    if (self.scriptsHtml) {
      const scripts = new DOMParser().parseFromString(self.scriptsHtml, 'text/html').getElementsByTagName('script');
      for (let i = 0; i < scripts.length; i++) {
        const script = document.createElement('script');
        script.text = scripts[i].text;
        document.head.appendChild(script).parentNode.removeChild(script);
      }
      self.scriptsHtml = '';
    }
  },
  methods: {
    initEditor(parameters) {
      const self = this;
      self.api = new AsyncEditorApiClient(parameters);
      self.contentId = parameters.contentId;
      self.editorGroup = parameters.editorGroup;
      self.defaultErrorText = parameters.defaultErrorText ?? 'Something went wrong.';
      self.asyncEditorId = parameters.asyncEditorId;
      if (!self.processQuery()) self.loadEditor();
    },
    loadEditor(editorGroup) {
      const self = this;
      self.editorGroup = editorGroup ?? self.editorGroup;
      self.api.loadEditor(self.contentId, self.editorGroup, (success, data) => {
        self.processApiData(success, data);
      });
    },
    submitEditor(nextEditorGroup) {
      const self = this;
      const submittingEditorEvent = new CustomEvent('asyncEditorSubmittingEditor', {
        bubbles: true,
        cancelable: true,
        detail: {
          asyncEditor: window.asyncEditor
        }
      });
      const success = document.dispatchEvent(submittingEditorEvent);
      if (success) {
        self.api.submitEditor(self.contentId, self.editorGroup, nextEditorGroup, new FormData(self.$refs.editorForm), (apiSuccess, data) => {
          self.processApiData(apiSuccess, data);
        });
      }
    },
    processApiData(success, data) {
      const self = this;
      if (success) {
        const shouldUpdateQuery = self.contentId !== data.contentId || self.editorGroup !== data.editorGroup;
        self.errorText = '';
        self.validationSummaryHtml = data.validationSummaryHtml;
        self.contentId = data.contentId;
        self.editorHtml = data.editorHtml;
        self.editorGroup = data.editorGroup;
        self.editorGroups = data.editorGroups;
        self.scriptsHtml = data.scriptsHtml;
        self.message = data.message;
        window.asyncEditor.editors[self.asyncEditorId].contentId = data.contentId;
        if (shouldUpdateQuery) self.updateQuery();
      } else {
        self.errorText = self.defaultErrorText;
      }
    },
    updateQuery() {
      const self = this;
      const query = {
        ...self.$route.query
      };
      query[self.asyncEditorId + '.contentId'] = self.contentId;
      query[self.asyncEditorId + '.editorGroup'] = self.editorGroup;
      router.push({
        path: '/',
        query: query
      });
    },
    processQuery() {
      const self = this;
      let shouldLoadEditor = false;
      const contentIdKey = self.asyncEditorId + '.contentId';
      if (contentIdKey in self.$route.query && self.$route.query[contentIdKey] !== self.contentId) {
        self.contentId = self.$route.query[contentIdKey];
        shouldLoadEditor = true;
      }
      const editorGroupKey = self.asyncEditorId + '.editorGroup';
      if (editorGroupKey in self.$route.query && self.$route.query[editorGroupKey] !== self.editorGroup) {
        self.editorGroup = self.$route.query[editorGroupKey];
        shouldLoadEditor = true;
      }
      if (shouldLoadEditor) {
        self.loadEditor();
      }
      return shouldLoadEditor;
    },
    isCurrentGroup(editorGroup) {
      return editorGroup === this.editorGroup;
    },
    isFirstGroup(editorGroup) {
      const self = this;
      return self.editorGroups.at(0)?.name === (editorGroup ?? self.editorGroup);
    },
    isLastGroup(editorGroup) {
      const self = this;
      return self.editorGroups.at(-1)?.name === (editorGroup ?? self.editorGroup);
    },
    getPreviousEditor(editorGroup) {
      const editorGroups = this.editorGroups.map(group => group.name);
      const index = editorGroups.indexOf(editorGroup ?? this.editorGroup);
      return editorGroups[index - 1];
    },
    getNextEditor(editorGroup) {
      const editorGroups = this.editorGroups.map(group => group.name);
      const index = editorGroups.indexOf(editorGroup ?? this.editorGroup);
      return editorGroups[index + 1];
    }
  }
};
window.initAsyncEditor = (asyncEditorId, parameters) => {
  if (!parameters) {
    return window.asyncEditor.editors[asyncEditorId];
  }
  window.asyncEditor.editors[asyncEditorId] = new Vue({
    el: parameters.element,
    data: {
      id: asyncEditorId
    },
    mounted: function () {
      parameters.asyncEditorId = asyncEditorId;
      this.$refs.editor.initEditor(parameters);
    },
    components: {
      'async-editor': window.asyncEditor.editor
    },
    template: '<async-editor ref="editor"></async-editor>'
  });
  return undefined;
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJ3aW5kb3ciLCJhc3luY0VkaXRvciIsImVkaXRvcnMiLCJBc3luY0VkaXRvckFwaUNsaWVudCIsImNvbnN0cnVjdG9yIiwicGFyYW1ldGVycyIsImFwaVVybCIsImFzeW5jRWRpdG9ySWQiLCJwcm92aWRlck5hbWUiLCJjb250ZW50VHlwZSIsImxvYWRFZGl0b3IiLCJjb250ZW50SWQiLCJlZGl0b3JHcm91cCIsImNhbGxiYWNrIiwiZmV0Y2giLCJjcmVhdGVVcmwiLCJ0aGVuIiwicmVzcG9uc2UiLCJqc29uIiwiZGF0YSIsImNhdGNoIiwiZXJyb3IiLCJzdWJtaXRFZGl0b3IiLCJuZXh0RWRpdG9yR3JvdXAiLCJmb3JtRGF0YSIsIm1ldGhvZCIsImhlYWRlcnMiLCJib2R5IiwiVVJMU2VhcmNoUGFyYW1zIiwic3VibWl0dGVkRWRpdG9yRXZlbnQiLCJDdXN0b21FdmVudCIsImJ1YmJsZXMiLCJjYW5jZWxhYmxlIiwiZGV0YWlsIiwiZG9jdW1lbnQiLCJkaXNwYXRjaEV2ZW50IiwidXJsIiwiVVJMIiwiYmFzZVVSSSIsInF1ZXJ5Iiwic2VhcmNoIiwidG9TdHJpbmciLCJyb3V0ZXIiLCJWdWVSb3V0ZXIiLCJlZGl0b3IiLCJ0ZW1wbGF0ZSIsImFwaSIsIm1lc3NhZ2UiLCJlcnJvclRleHQiLCJlZGl0b3JIdG1sIiwidmFsaWRhdGlvblN1bW1hcnlIdG1sIiwiZWRpdG9yR3JvdXBzIiwiZGVmYXVsdEVycm9yVGV4dCIsInNjcmlwdHNIdG1sIiwiY29tcHV0ZWQiLCJwcm9ncmVzcyIsInNlbGYiLCJsZW5ndGgiLCJmaWx0ZXIiLCJncm91cCIsImlzRmlsbGVkIiwic2hvd1Byb2dyZXNzQmFyIiwid2F0Y2giLCJwcm9jZXNzUXVlcnkiLCJ1cGRhdGVkIiwic2NyaXB0cyIsIkRPTVBhcnNlciIsInBhcnNlRnJvbVN0cmluZyIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiaSIsInNjcmlwdCIsImNyZWF0ZUVsZW1lbnQiLCJ0ZXh0IiwiaGVhZCIsImFwcGVuZENoaWxkIiwicGFyZW50Tm9kZSIsInJlbW92ZUNoaWxkIiwibWV0aG9kcyIsImluaXRFZGl0b3IiLCJzdWNjZXNzIiwicHJvY2Vzc0FwaURhdGEiLCJzdWJtaXR0aW5nRWRpdG9yRXZlbnQiLCJGb3JtRGF0YSIsIiRyZWZzIiwiZWRpdG9yRm9ybSIsImFwaVN1Y2Nlc3MiLCJzaG91bGRVcGRhdGVRdWVyeSIsInVwZGF0ZVF1ZXJ5IiwiJHJvdXRlIiwicHVzaCIsInBhdGgiLCJzaG91bGRMb2FkRWRpdG9yIiwiY29udGVudElkS2V5IiwiZWRpdG9yR3JvdXBLZXkiLCJpc0N1cnJlbnRHcm91cCIsImlzRmlyc3RHcm91cCIsImF0IiwibmFtZSIsImlzTGFzdEdyb3VwIiwiZ2V0UHJldmlvdXNFZGl0b3IiLCJtYXAiLCJpbmRleCIsImluZGV4T2YiLCJnZXROZXh0RWRpdG9yIiwiaW5pdEFzeW5jRWRpdG9yIiwiVnVlIiwiZWwiLCJlbGVtZW50IiwiaWQiLCJtb3VudGVkIiwiY29tcG9uZW50cyIsInVuZGVmaW5lZCJdLCJzb3VyY2VzIjpbIi4uLy4uL0Fzc2V0cy9TY3JpcHRzL2FzeW5jLWVkaXRvci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgVnVlICovXHJcbi8qIGdsb2JhbCBWdWVSb3V0ZXIgKi9cclxuXHJcbmlmICghd2luZG93LmFzeW5jRWRpdG9yKSB3aW5kb3cuYXN5bmNFZGl0b3IgPSB7IGVkaXRvcnM6IFtdIH07XHJcblxyXG5jbGFzcyBBc3luY0VkaXRvckFwaUNsaWVudCB7XHJcbiAgICBjb25zdHJ1Y3RvcihwYXJhbWV0ZXJzKSB7XHJcbiAgICAgICAgdGhpcy5hcGlVcmwgPSBwYXJhbWV0ZXJzLmFwaVVybDtcclxuICAgICAgICB0aGlzLmFzeW5jRWRpdG9ySWQgPSBwYXJhbWV0ZXJzLmFzeW5jRWRpdG9ySWQ7XHJcbiAgICAgICAgdGhpcy5wcm92aWRlck5hbWUgPSBwYXJhbWV0ZXJzLnByb3ZpZGVyTmFtZTtcclxuICAgICAgICB0aGlzLmNvbnRlbnRUeXBlID0gcGFyYW1ldGVycy5jb250ZW50VHlwZTtcclxuICAgIH1cclxuXHJcbiAgICBsb2FkRWRpdG9yKGNvbnRlbnRJZCwgZWRpdG9yR3JvdXAsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgcmV0dXJuIGZldGNoKHRoaXMuY3JlYXRlVXJsKGNvbnRlbnRJZCwgZWRpdG9yR3JvdXApKVxyXG4gICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHJlc3BvbnNlLmpzb24oKSlcclxuICAgICAgICAgICAgLnRoZW4oKGRhdGEpID0+IGNhbGxiYWNrKHRydWUsIGRhdGEpKVxyXG4gICAgICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiBjYWxsYmFjayhmYWxzZSwgZXJyb3IpKTtcclxuICAgIH1cclxuXHJcbiAgICBzdWJtaXRFZGl0b3IoY29udGVudElkLCBlZGl0b3JHcm91cCwgbmV4dEVkaXRvckdyb3VwLCBmb3JtRGF0YSwgY2FsbGJhY2spIHtcclxuICAgICAgICByZXR1cm4gZmV0Y2godGhpcy5jcmVhdGVVcmwoY29udGVudElkLCBlZGl0b3JHcm91cCwgbmV4dEVkaXRvckdyb3VwKSwge1xyXG4gICAgICAgICAgICBtZXRob2Q6ICdwb3N0JyxcclxuICAgICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQ7Y2hhcnNldD1VVEYtOCcsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGJvZHk6IG5ldyBVUkxTZWFyY2hQYXJhbXMoZm9ybURhdGEpLFxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gcmVzcG9uc2UuanNvbigpKVxyXG4gICAgICAgICAgICAudGhlbigoZGF0YSkgPT4gY2FsbGJhY2sodHJ1ZSwgZGF0YSkpXHJcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHN1Ym1pdHRlZEVkaXRvckV2ZW50ID0gbmV3IEN1c3RvbUV2ZW50KCdhc3luY0VkaXRvclN1Ym1pdHRlZEVkaXRvcicsIHtcclxuICAgICAgICAgICAgICAgICAgICBidWJibGVzOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIGNhbmNlbGFibGU6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgZGV0YWlsOiB7IGFzeW5jRWRpdG9yOiB3aW5kb3cuYXN5bmNFZGl0b3IgfSxcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuZGlzcGF0Y2hFdmVudChzdWJtaXR0ZWRFZGl0b3JFdmVudCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IGNhbGxiYWNrKGZhbHNlLCBlcnJvcikpO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZVVybChjb250ZW50SWQsIGVkaXRvckdyb3VwLCBuZXh0RWRpdG9yR3JvdXApIHtcclxuICAgICAgICBjb25zdCB1cmwgPSBuZXcgVVJMKHRoaXMuYXBpVXJsLCBkb2N1bWVudC5iYXNlVVJJKTtcclxuICAgICAgICBjb25zdCBxdWVyeSA9IHtcclxuICAgICAgICAgICAgYXN5bmNFZGl0b3JJZDogdGhpcy5hc3luY0VkaXRvcklkLFxyXG4gICAgICAgICAgICBwcm92aWRlck5hbWU6IHRoaXMucHJvdmlkZXJOYW1lLFxyXG4gICAgICAgICAgICBjb250ZW50VHlwZTogdGhpcy5jb250ZW50VHlwZSxcclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmIChjb250ZW50SWQpIHF1ZXJ5LmNvbnRlbnRJZCA9IGNvbnRlbnRJZDtcclxuICAgICAgICBpZiAoZWRpdG9yR3JvdXApIHF1ZXJ5LmVkaXRvckdyb3VwID0gZWRpdG9yR3JvdXA7XHJcbiAgICAgICAgaWYgKG5leHRFZGl0b3JHcm91cCkgcXVlcnkubmV4dEVkaXRvckdyb3VwID0gbmV4dEVkaXRvckdyb3VwO1xyXG4gICAgICAgIHVybC5zZWFyY2ggPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHF1ZXJ5KS50b1N0cmluZygpO1xyXG5cclxuICAgICAgICByZXR1cm4gdXJsO1xyXG4gICAgfVxyXG59XHJcblxyXG5jb25zdCByb3V0ZXIgPSBuZXcgVnVlUm91dGVyKCk7XHJcblxyXG4vLyBNYWtpbmcgdGhlIFZ1ZSBvYmplY3QgbW9yZSByZWFkYWJsZS5cclxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG9iamVjdC1zaG9ydGhhbmRcclxud2luZG93LmFzeW5jRWRpdG9yLmVkaXRvciA9IHtcclxuICAgIHRlbXBsYXRlOiAnI2FzeW5jLWVkaXRvci10ZW1wbGF0ZScsXHJcbiAgICBkYXRhKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGFzeW5jRWRpdG9ySWQ6ICcnLFxyXG4gICAgICAgICAgICBhcGk6IG51bGwsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICcnLFxyXG4gICAgICAgICAgICBlcnJvclRleHQ6ICcnLFxyXG4gICAgICAgICAgICBjb250ZW50SWQ6ICcnLFxyXG4gICAgICAgICAgICBlZGl0b3JIdG1sOiAnJyxcclxuICAgICAgICAgICAgdmFsaWRhdGlvblN1bW1hcnlIdG1sOiAnJyxcclxuICAgICAgICAgICAgZWRpdG9yR3JvdXA6ICcnLFxyXG4gICAgICAgICAgICBlZGl0b3JHcm91cHM6IFtdLFxyXG4gICAgICAgICAgICBkZWZhdWx0RXJyb3JUZXh0OiAnJyxcclxuICAgICAgICAgICAgc2NyaXB0c0h0bWw6ICcnLFxyXG4gICAgICAgIH07XHJcbiAgICB9LFxyXG4gICAgY29tcHV0ZWQ6IHtcclxuICAgICAgICBwcm9ncmVzcyhzZWxmKSB7XHJcbiAgICAgICAgICAgIGlmIChzZWxmLmVkaXRvckdyb3Vwcy5sZW5ndGggPCAxKSByZXR1cm4gMDtcclxuICAgICAgICAgICAgcmV0dXJuIChzZWxmLmVkaXRvckdyb3Vwcy5maWx0ZXIoKGdyb3VwKSA9PiBncm91cC5pc0ZpbGxlZCkubGVuZ3RoIC8gc2VsZi5lZGl0b3JHcm91cHMubGVuZ3RoKSAqIDEwMDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNob3dQcm9ncmVzc0JhcihzZWxmKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBzZWxmLmVkaXRvckdyb3Vwcy5sZW5ndGggPiAxO1xyXG4gICAgICAgIH0sXHJcbiAgICB9LFxyXG4gICAgd2F0Y2g6IHtcclxuICAgICAgICAnJHJvdXRlLnF1ZXJ5JygpIHtcclxuICAgICAgICAgICAgdGhpcy5wcm9jZXNzUXVlcnkoKTtcclxuICAgICAgICB9LFxyXG4gICAgfSxcclxuICAgIHJvdXRlcixcclxuICAgIHVwZGF0ZWQoKSB7XHJcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgaWYgKHNlbGYuc2NyaXB0c0h0bWwpIHtcclxuICAgICAgICAgICAgY29uc3Qgc2NyaXB0cyA9IG5ldyBET01QYXJzZXIoKVxyXG4gICAgICAgICAgICAgICAgLnBhcnNlRnJvbVN0cmluZyhzZWxmLnNjcmlwdHNIdG1sLCAndGV4dC9odG1sJylcclxuICAgICAgICAgICAgICAgIC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0Jyk7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2NyaXB0cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XHJcbiAgICAgICAgICAgICAgICBzY3JpcHQudGV4dCA9IHNjcmlwdHNbaV0udGV4dDtcclxuICAgICAgICAgICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHNjcmlwdCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHNlbGYuc2NyaXB0c0h0bWwgPSAnJztcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgbWV0aG9kczoge1xyXG4gICAgICAgIGluaXRFZGl0b3IocGFyYW1ldGVycykge1xyXG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgICAgIHNlbGYuYXBpID0gbmV3IEFzeW5jRWRpdG9yQXBpQ2xpZW50KHBhcmFtZXRlcnMpO1xyXG4gICAgICAgICAgICBzZWxmLmNvbnRlbnRJZCA9IHBhcmFtZXRlcnMuY29udGVudElkO1xyXG4gICAgICAgICAgICBzZWxmLmVkaXRvckdyb3VwID0gcGFyYW1ldGVycy5lZGl0b3JHcm91cDtcclxuICAgICAgICAgICAgc2VsZi5kZWZhdWx0RXJyb3JUZXh0ID0gcGFyYW1ldGVycy5kZWZhdWx0RXJyb3JUZXh0ID8/ICdTb21ldGhpbmcgd2VudCB3cm9uZy4nO1xyXG4gICAgICAgICAgICBzZWxmLmFzeW5jRWRpdG9ySWQgPSBwYXJhbWV0ZXJzLmFzeW5jRWRpdG9ySWQ7XHJcblxyXG4gICAgICAgICAgICBpZiAoIXNlbGYucHJvY2Vzc1F1ZXJ5KCkpIHNlbGYubG9hZEVkaXRvcigpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbG9hZEVkaXRvcihlZGl0b3JHcm91cCkge1xyXG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgICAgIHNlbGYuZWRpdG9yR3JvdXAgPSBlZGl0b3JHcm91cCA/PyBzZWxmLmVkaXRvckdyb3VwO1xyXG5cclxuICAgICAgICAgICAgc2VsZi5hcGkubG9hZEVkaXRvcihcclxuICAgICAgICAgICAgICAgIHNlbGYuY29udGVudElkLFxyXG4gICAgICAgICAgICAgICAgc2VsZi5lZGl0b3JHcm91cCxcclxuICAgICAgICAgICAgICAgIChzdWNjZXNzLCBkYXRhKSA9PiB7IHNlbGYucHJvY2Vzc0FwaURhdGEoc3VjY2VzcywgZGF0YSk7IH0pO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc3VibWl0RWRpdG9yKG5leHRFZGl0b3JHcm91cCkge1xyXG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgICAgICAgICAgY29uc3Qgc3VibWl0dGluZ0VkaXRvckV2ZW50ID0gbmV3IEN1c3RvbUV2ZW50KCdhc3luY0VkaXRvclN1Ym1pdHRpbmdFZGl0b3InLCB7XHJcbiAgICAgICAgICAgICAgICBidWJibGVzOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgY2FuY2VsYWJsZTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIGRldGFpbDogeyBhc3luY0VkaXRvcjogd2luZG93LmFzeW5jRWRpdG9yIH0sXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgY29uc3Qgc3VjY2VzcyA9IGRvY3VtZW50LmRpc3BhdGNoRXZlbnQoc3VibWl0dGluZ0VkaXRvckV2ZW50KTtcclxuICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgIHNlbGYuYXBpLnN1Ym1pdEVkaXRvcihcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLmNvbnRlbnRJZCxcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLmVkaXRvckdyb3VwLFxyXG4gICAgICAgICAgICAgICAgICAgIG5leHRFZGl0b3JHcm91cCxcclxuICAgICAgICAgICAgICAgICAgICBuZXcgRm9ybURhdGEoc2VsZi4kcmVmcy5lZGl0b3JGb3JtKSxcclxuICAgICAgICAgICAgICAgICAgICAoYXBpU3VjY2VzcywgZGF0YSkgPT4geyBzZWxmLnByb2Nlc3NBcGlEYXRhKGFwaVN1Y2Nlc3MsIGRhdGEpOyB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcHJvY2Vzc0FwaURhdGEoc3VjY2VzcywgZGF0YSkge1xyXG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgICAgIGlmIChzdWNjZXNzKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzaG91bGRVcGRhdGVRdWVyeSA9IHNlbGYuY29udGVudElkICE9PSBkYXRhLmNvbnRlbnRJZCB8fCBzZWxmLmVkaXRvckdyb3VwICE9PSBkYXRhLmVkaXRvckdyb3VwO1xyXG5cclxuICAgICAgICAgICAgICAgIHNlbGYuZXJyb3JUZXh0ID0gJyc7XHJcbiAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRpb25TdW1tYXJ5SHRtbCA9IGRhdGEudmFsaWRhdGlvblN1bW1hcnlIdG1sO1xyXG4gICAgICAgICAgICAgICAgc2VsZi5jb250ZW50SWQgPSBkYXRhLmNvbnRlbnRJZDtcclxuICAgICAgICAgICAgICAgIHNlbGYuZWRpdG9ySHRtbCA9IGRhdGEuZWRpdG9ySHRtbDtcclxuICAgICAgICAgICAgICAgIHNlbGYuZWRpdG9yR3JvdXAgPSBkYXRhLmVkaXRvckdyb3VwO1xyXG4gICAgICAgICAgICAgICAgc2VsZi5lZGl0b3JHcm91cHMgPSBkYXRhLmVkaXRvckdyb3VwcztcclxuICAgICAgICAgICAgICAgIHNlbGYuc2NyaXB0c0h0bWwgPSBkYXRhLnNjcmlwdHNIdG1sO1xyXG4gICAgICAgICAgICAgICAgc2VsZi5tZXNzYWdlID0gZGF0YS5tZXNzYWdlO1xyXG5cclxuICAgICAgICAgICAgICAgIHdpbmRvdy5hc3luY0VkaXRvci5lZGl0b3JzW3NlbGYuYXN5bmNFZGl0b3JJZF0uY29udGVudElkID0gZGF0YS5jb250ZW50SWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHNob3VsZFVwZGF0ZVF1ZXJ5KSBzZWxmLnVwZGF0ZVF1ZXJ5KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzZWxmLmVycm9yVGV4dCA9IHNlbGYuZGVmYXVsdEVycm9yVGV4dDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdXBkYXRlUXVlcnkoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgcXVlcnkgPSB7IC4uLnNlbGYuJHJvdXRlLnF1ZXJ5IH07XHJcbiAgICAgICAgICAgIHF1ZXJ5W3NlbGYuYXN5bmNFZGl0b3JJZCArICcuY29udGVudElkJ10gPSBzZWxmLmNvbnRlbnRJZDtcclxuICAgICAgICAgICAgcXVlcnlbc2VsZi5hc3luY0VkaXRvcklkICsgJy5lZGl0b3JHcm91cCddID0gc2VsZi5lZGl0b3JHcm91cDtcclxuXHJcbiAgICAgICAgICAgIHJvdXRlci5wdXNoKHsgcGF0aDogJy8nLCBxdWVyeTogcXVlcnkgfSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBwcm9jZXNzUXVlcnkoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICAgICAgbGV0IHNob3VsZExvYWRFZGl0b3IgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnRJZEtleSA9IHNlbGYuYXN5bmNFZGl0b3JJZCArICcuY29udGVudElkJztcclxuICAgICAgICAgICAgaWYgKGNvbnRlbnRJZEtleSBpbiBzZWxmLiRyb3V0ZS5xdWVyeSAmJlxyXG4gICAgICAgICAgICAgICAgc2VsZi4kcm91dGUucXVlcnlbY29udGVudElkS2V5XSAhPT0gc2VsZi5jb250ZW50SWQpIHtcclxuICAgICAgICAgICAgICAgIHNlbGYuY29udGVudElkID0gc2VsZi4kcm91dGUucXVlcnlbY29udGVudElkS2V5XTtcclxuICAgICAgICAgICAgICAgIHNob3VsZExvYWRFZGl0b3IgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCBlZGl0b3JHcm91cEtleSA9IHNlbGYuYXN5bmNFZGl0b3JJZCArICcuZWRpdG9yR3JvdXAnO1xyXG4gICAgICAgICAgICBpZiAoZWRpdG9yR3JvdXBLZXkgaW4gc2VsZi4kcm91dGUucXVlcnkgJiZcclxuICAgICAgICAgICAgICAgIHNlbGYuJHJvdXRlLnF1ZXJ5W2VkaXRvckdyb3VwS2V5XSAhPT0gc2VsZi5lZGl0b3JHcm91cCkge1xyXG4gICAgICAgICAgICAgICAgc2VsZi5lZGl0b3JHcm91cCA9IHNlbGYuJHJvdXRlLnF1ZXJ5W2VkaXRvckdyb3VwS2V5XTtcclxuICAgICAgICAgICAgICAgIHNob3VsZExvYWRFZGl0b3IgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoc2hvdWxkTG9hZEVkaXRvcikge1xyXG4gICAgICAgICAgICAgICAgc2VsZi5sb2FkRWRpdG9yKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBzaG91bGRMb2FkRWRpdG9yO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgaXNDdXJyZW50R3JvdXAoZWRpdG9yR3JvdXApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVkaXRvckdyb3VwID09PSB0aGlzLmVkaXRvckdyb3VwO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgaXNGaXJzdEdyb3VwKGVkaXRvckdyb3VwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHNlbGYuZWRpdG9yR3JvdXBzLmF0KDApPy5uYW1lID09PSAoZWRpdG9yR3JvdXAgPz8gc2VsZi5lZGl0b3JHcm91cCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBpc0xhc3RHcm91cChlZGl0b3JHcm91cCkge1xyXG4gICAgICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBzZWxmLmVkaXRvckdyb3Vwcy5hdCgtMSk/Lm5hbWUgPT09IChlZGl0b3JHcm91cCA/PyBzZWxmLmVkaXRvckdyb3VwKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGdldFByZXZpb3VzRWRpdG9yKGVkaXRvckdyb3VwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGVkaXRvckdyb3VwcyA9IHRoaXMuZWRpdG9yR3JvdXBzLm1hcCgoZ3JvdXApID0+IGdyb3VwLm5hbWUpO1xyXG4gICAgICAgICAgICBjb25zdCBpbmRleCA9IGVkaXRvckdyb3Vwcy5pbmRleE9mKGVkaXRvckdyb3VwID8/IHRoaXMuZWRpdG9yR3JvdXApO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGVkaXRvckdyb3Vwc1tpbmRleCAtIDFdO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZ2V0TmV4dEVkaXRvcihlZGl0b3JHcm91cCkge1xyXG4gICAgICAgICAgICBjb25zdCBlZGl0b3JHcm91cHMgPSB0aGlzLmVkaXRvckdyb3Vwcy5tYXAoKGdyb3VwKSA9PiBncm91cC5uYW1lKTtcclxuICAgICAgICAgICAgY29uc3QgaW5kZXggPSBlZGl0b3JHcm91cHMuaW5kZXhPZihlZGl0b3JHcm91cCA/PyB0aGlzLmVkaXRvckdyb3VwKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBlZGl0b3JHcm91cHNbaW5kZXggKyAxXTtcclxuICAgICAgICB9LFxyXG4gICAgfSxcclxufTtcclxuXHJcbndpbmRvdy5pbml0QXN5bmNFZGl0b3IgPSAoYXN5bmNFZGl0b3JJZCwgcGFyYW1ldGVycykgPT4ge1xyXG4gICAgaWYgKCFwYXJhbWV0ZXJzKSB7XHJcbiAgICAgICAgcmV0dXJuIHdpbmRvdy5hc3luY0VkaXRvci5lZGl0b3JzW2FzeW5jRWRpdG9ySWRdO1xyXG4gICAgfVxyXG5cclxuICAgIHdpbmRvdy5hc3luY0VkaXRvci5lZGl0b3JzW2FzeW5jRWRpdG9ySWRdID0gbmV3IFZ1ZSh7XHJcbiAgICAgICAgZWw6IHBhcmFtZXRlcnMuZWxlbWVudCxcclxuICAgICAgICBkYXRhOiB7IGlkOiBhc3luY0VkaXRvcklkIH0sXHJcbiAgICAgICAgbW91bnRlZDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBwYXJhbWV0ZXJzLmFzeW5jRWRpdG9ySWQgPSBhc3luY0VkaXRvcklkO1xyXG4gICAgICAgICAgICB0aGlzLiRyZWZzLmVkaXRvci5pbml0RWRpdG9yKHBhcmFtZXRlcnMpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgY29tcG9uZW50czoge1xyXG4gICAgICAgICAgICAnYXN5bmMtZWRpdG9yJzogd2luZG93LmFzeW5jRWRpdG9yLmVkaXRvcixcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRlbXBsYXRlOiAnPGFzeW5jLWVkaXRvciByZWY9XCJlZGl0b3JcIj48L2FzeW5jLWVkaXRvcj4nLFxyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcclxufTtcclxuIl0sIm1hcHBpbmdzIjoiOztBQUFBO0FBQ0E7O0FBRUEsSUFBSSxDQUFDQSxNQUFNLENBQUNDLFdBQVcsRUFBRUQsTUFBTSxDQUFDQyxXQUFXLEdBQUc7RUFBRUMsT0FBTyxFQUFFO0FBQUcsQ0FBQztBQUU3RCxNQUFNQyxvQkFBb0IsQ0FBQztFQUN2QkMsV0FBVyxDQUFDQyxVQUFVLEVBQUU7SUFDcEIsSUFBSSxDQUFDQyxNQUFNLEdBQUdELFVBQVUsQ0FBQ0MsTUFBTTtJQUMvQixJQUFJLENBQUNDLGFBQWEsR0FBR0YsVUFBVSxDQUFDRSxhQUFhO0lBQzdDLElBQUksQ0FBQ0MsWUFBWSxHQUFHSCxVQUFVLENBQUNHLFlBQVk7SUFDM0MsSUFBSSxDQUFDQyxXQUFXLEdBQUdKLFVBQVUsQ0FBQ0ksV0FBVztFQUM3QztFQUVBQyxVQUFVLENBQUNDLFNBQVMsRUFBRUMsV0FBVyxFQUFFQyxRQUFRLEVBQUU7SUFDekMsT0FBT0MsS0FBSyxDQUFDLElBQUksQ0FBQ0MsU0FBUyxDQUFDSixTQUFTLEVBQUVDLFdBQVcsQ0FBQyxDQUFDLENBQy9DSSxJQUFJLENBQUVDLFFBQVEsSUFBS0EsUUFBUSxDQUFDQyxJQUFJLEVBQUUsQ0FBQyxDQUNuQ0YsSUFBSSxDQUFFRyxJQUFJLElBQUtOLFFBQVEsQ0FBQyxJQUFJLEVBQUVNLElBQUksQ0FBQyxDQUFDLENBQ3BDQyxLQUFLLENBQUVDLEtBQUssSUFBS1IsUUFBUSxDQUFDLEtBQUssRUFBRVEsS0FBSyxDQUFDLENBQUM7RUFDakQ7RUFFQUMsWUFBWSxDQUFDWCxTQUFTLEVBQUVDLFdBQVcsRUFBRVcsZUFBZSxFQUFFQyxRQUFRLEVBQUVYLFFBQVEsRUFBRTtJ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