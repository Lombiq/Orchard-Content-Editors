"use strict";window.asyncEditor||(window.asyncEditor={editors:[]});class AsyncEditorApiClient{constructor(t){this.apiUrl=t.apiUrl,this.asyncEditorId=t.asyncEditorId,this.providerName=t.providerName,this.contentType=t.contentType}loadEditor(t,r,e){return fetch(this.createUrl(t,r)).then((t=>t.json())).then((t=>e(!0,t))).catch((t=>e(!1,t)))}submitEditor(t,r,e,o,i){return fetch(this.createUrl(t,r,e),{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:new URLSearchParams(o)}).then((t=>t.json())).then((t=>i(!0,t))).then((()=>{const t=new CustomEvent("asyncEditorSubmittedEditor",{bubbles:!0,cancelable:!0,detail:{asyncEditor:window.asyncEditor}});document.dispatchEvent(t)})).catch((t=>i(!1,t)))}createUrl(t,r,e){const o=new URL(this.apiUrl,document.baseURI),i={asyncEditorId:this.asyncEditorId,providerName:this.providerName,contentType:this.contentType};return t&&(i.contentId=t),r&&(i.editorGroup=r),e&&(i.nextEditorGroup=e),o.search=new URLSearchParams(i).toString(),o}}const router=new VueRouter;window.asyncEditor.editor={template:"#async-editor-template",data:()=>({asyncEditorId:"",api:null,message:"",errorText:"",contentId:"",editorHtml:"",validationSummaryHtml:"",editorGroup:"",editorGroups:[],defaultErrorText:"",scriptsHtml:""}),computed:{progress:t=>t.editorGroups.length<1?0:t.editorGroups.filter((t=>t.isFilled)).length/t.editorGroups.length*100,showProgressBar:t=>t.editorGroups.length>1},watch:{"$route.query"(){this.processQuery()}},router:router,updated(){const t=this;if(t.scriptsHtml){const r=(new DOMParser).parseFromString(t.scriptsHtml,"text/html").getElementsByTagName("script");for(let t=0;t<r.length;t++){const e=document.createElement("script");e.text=r[t].text,document.head.appendChild(e).parentNode.removeChild(e)}t.scriptsHtml=""}},methods:{initEditor(t){const r=this;r.api=new AsyncEditorApiClient(t),r.contentId=t.contentId,r.editorGroup=t.editorGroup,r.defaultErrorText=t.defaultErrorText??"Something went wrong.",r.asyncEditorId=t.asyncEditorId,r.processQuery()||r.loadEditor()},loadEditor(t){const r=this;r.editorGroup=t??r.editorGroup,r.api.loadEditor(r.contentId,r.editorGroup,((t,e)=>{r.processApiData(t,e)}))},submitEditor(t){const r=this,e=new CustomEvent("asyncEditorSubmittingEditor",{bubbles:!0,cancelable:!0,detail:{asyncEditor:window.asyncEditor}});document.dispatchEvent(e)&&r.api.submitEditor(r.contentId,r.editorGroup,t,new FormData(r.$refs.editorForm),((t,e)=>{r.processApiData(t,e)}))},processApiData(t,r){const e=this;if(t){const t=e.contentId!==r.contentId||e.editorGroup!==r.editorGroup;e.errorText="",e.validationSummaryHtml=r.validationSummaryHtml,e.contentId=r.contentId,e.editorHtml=r.editorHtml,e.editorGroup=r.editorGroup,e.editorGroups=r.editorGroups,e.scriptsHtml=r.scriptsHtml,e.message=r.message,window.asyncEditor.editors[e.asyncEditorId].contentId=r.contentId,t&&e.updateQuery()}else e.errorText=e.defaultErrorText},updateQuery(){const t=this,r={...t.$route.query};r[t.asyncEditorId+".contentId"]=t.contentId,r[t.asyncEditorId+".editorGroup"]=t.editorGroup,router.push({path:"/",query:r})},processQuery(){const t=this;let r=!1;const e=t.asyncEditorId+".contentId";e in t.$route.query&&t.$route.query[e]!==t.contentId&&(t.contentId=t.$route.query[e],r=!0);const o=t.asyncEditorId+".editorGroup";return o in t.$route.query&&t.$route.query[o]!==t.editorGroup&&(t.editorGroup=t.$route.query[o],r=!0),r&&t.loadEditor(),r},isCurrentGroup(t){return t===this.editorGroup},isFirstGroup(t){return this.editorGroups.at(0)?.name===(t??this.editorGroup)},isLastGroup(t){return this.editorGroups.at(-1)?.name===(t??this.editorGroup)},getPreviousEditor(t){const r=this.editorGroups.map((t=>t.name)),e=r.indexOf(t??this.editorGroup);return r[e-1]},getNextEditor(t){const r=this.editorGroups.map((t=>t.name)),e=r.indexOf(t??this.editorGroup);return r[e+1]}}},window.initAsyncEditor=(t,r)=>{if(!r)return window.asyncEditor.editors[t];window.asyncEditor.editors[t]=new Vue({el:r.element,data:{id:t},mounted:function(){r.asyncEditorId=t,this.$refs.editor.initEditor(r)},components:{"async-editor":window.asyncEditor.editor},template:'<async-editor ref="editor"></async-editor>'})};
//# sourceMappingURL=async-editor.min.js.map