@using Lombiq.ContentEditors.Constants

@{
    var contentType = Model.ContentType as string;

    // Initial content item ID can be given as a shape parameter or can be empty if the item is new.
    var contentItemId = Model.ContentItemId as int? ?? 0;

    // Default group can be given as a shape parameter.
    // If the <ContentType>EditorGroup query string parameter is given then the value of it is stronger.
    var defaultGroup = Model.EditorGroup as string;

    Script.Require(ResourceNames.Lombiq_AsyncEditor).AtHead();

    var editUrl = Model.EditUrl ?? Url.Action("Edit", "AsyncEditor", new { Area = "Lombiq.ContentEditors" });
    var useStaticLoadingIndicator = Model.UseStaticLoadingIndicator as bool? ?? false;

    string AsyncEditorLoaderId = Html.AsyncEditorPluginId(contentType);
}

@Display.Lombiq_AsyncEditorLoader_Container(AsyncEditorLoaderId: AsyncEditorLoaderId)


<script type="text/javascript">
    ; (function ($) {
        $(function () {
            $("#@AsyncEditorLoaderId").lombiq_AsyncEditor({
                asyncEditorApiUrl: "@editUrl",
                contentType: "@contentType",
                initialContentItemId: @contentItemId,
                defaultEditorGroupName: "@defaultGroup",
                asyncEditorLoaderElementClass: ".js-@ElementNames.AsyncEditorLoader.BlockName",
                processingIndicatorElementClass: "@(useStaticLoadingIndicator ? "" : ".js-" + ElementNames.AsyncEditorLoader.ProcessingIndicatorElementName)",
                editorPlaceholderElementClass: ".js-@ElementNames.AsyncEditorLoader.EditorPlaceholderElementName",
                loadEditorActionElementClass: ".js-@ElementNames.AsyncEditorActions.LoadEditorElementName",
                postEditorActionElementClass: ".js-@ElementNames.AsyncEditorActions.PostEditorElementName",
                dirtyFormLeaveConfirmationText: "@HttpUtility.JavaScriptStringEncode(T("Are you sure you want to leave this editor group? Changes you made may not be saved.").Text)",
            });
        });
    })(jQuery);
</script>